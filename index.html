<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/public/css/styles.css">
    <title>Arckanoid Game in Js</title>
</head>

<canvas>
</canvas>

<script>
    const canvas = document.querySelector('canvas');
    const ctx = canvas.getContext('2d');

    canvas.width = 448
    canvas.height = 400


    //variables pelota

    const ballRadius = 3;
    //posicion de la pelota
    let x = canvas.width / 2
    let y = canvas.height - 30
    //velocidad pelota
    let dx = -3
    let dy = -3

    //Variables de la pleta - paddle
    const paddleHeight = 10;
    const paddleWidth = 50;

    let paddleX = (canvas.width - paddleWidth) / 2
    let paddleY = canvas.height - paddleHeight - 10

    let rightPressed = false
    let leftPressed = false

    const Paddle_sensitivity = 7


    function drawBall() {
        //comienza un camino
        ctx.beginPath();
        ctx.arc(x, y, ballRadius, 0, Math.PI * 2);
        ctx.fillStyle = '#fff'
        ctx.fill()
        ctx.closePath()
    }


    function drawPaddle() {
        ctx.fillStyle = '#fff'
        ctx.fillRect(
            paddleX, //x, coordenadas
            paddleY, // y
            paddleWidth, //width, lo que va a dibujar
            paddleHeight // height
        )
    }
    function drawBricks() { }

    function collisionDetection() { }
    function ballMovement() {
        //rebotar las pelotas laterales

        if (
            x + dx > canvas.width - ballRadius || //rebotar en la pared derecha
            x + dx < ballRadius //rebotar en la pared izquierda
        ) {
            dx = -dx
        }

        if (
            y + dy < ballRadius //rebotar en la pared de arriba
        ) {
            dy = -dy
        }

        // la pelota toca el suelo

        const isBallSameAsPaddle =
        x > paddleX && //revisa la posicion del paddleX "-----" (su pocicion inicial)
        x < paddleX + paddleWidth // revisa todo el entorno que ocupa el paddleX "-----" la pocision final
        
        const isBallTouchingPaddle =
        y + dy > paddleY

        if (isBallTouchingPaddle && isBallSameAsPaddle) {
            dy = -dy;
        }

        else if (y + dy > canvas.height - ballRadius) { //la pelota toca el suelo
            console.log('Game Over');
            document.location.reload()
        }

        x += dx
        y += dy
    }
    function paddleMovement() {
        if (rightPressed === true && paddleX < canvas.width - paddleWidth) {
            paddleX += Paddle_sensitivity
        } else if (leftPressed === true && paddleX > 0) {
            paddleX -= Paddle_sensitivity
        }
    }

    function cleanCanvas() {
        ctx.clearRect(0, 0, canvas.width, canvas.height)
    }

    function initEvents() {
        document.addEventListener('keydown', KeyDownHandler);
        document.addEventListener('keyup', KeyUpHandler);

        function KeyDownHandler(event) {
            const { key } = event
            if (key === 'Left' || key === 'ArrowLeft') {
                leftPressed = true
            }

            if (key === 'Right' || key === 'ArrowRight') {
                rightPressed = true
            }
        }

        function KeyUpHandler(event) {
            const { key } = event
            if (key === 'Left' || key === 'ArrowLeft') {
                leftPressed = false
            }

            if (key === 'Right' || key === 'ArrowRight') {
                rightPressed = false
            }
        }
    }

    // infitine loop for game - good for all games
    function draw() {
        cleanCanvas()
        // check de dibujos y coliciones
        drawBall();
        drawPaddle();
        drawBricks();

        collisionDetection();
        ballMovement();
        paddleMovement();

        window.requestAnimationFrame(draw)
    }

    draw()
    initEvents()
</script>

</html>